language: bash

before_install:
  - echo "======= before install ====="

install: echo "======= install ====="

stages:
  - name: test
    if: NOT (tag =~ /^v([0-9]+)\.([0-9]+)\.([0-9]+).*$/)
  - name: deploy

jobs:
  include:
    - stage: test
      name: job1
      before_script: echo "===== job1 before script ======"
      script: echo "===== job1 ======"

    - stage: test
      name: job2
      script: echo "===== job2 ======"

    - stage: deploy
      deploy:
        - provider: script
          skip_cleanup: true
          script: echo "=====  deploy ===="
          all_branches: true
          condition: $TRAVIS_BRANCH =~ ^master || $TRAVIS_TAG =~ ^v([0-9]+)\.([0-9]+)\.([0-9]+).*$

# tag version following semantic versioning - e.g. v0.70.0-alpha
# regexp expression simplified for readability - see full regexp here: https://regexr.com/39s32
branches:
  only:
    - master
    - /^v([0-9]+)\.([0-9]+)\.([0-9]+).*$/
